---
title: "Safety_Score_Calculation"
date: "4/10/2018"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readr)
airline_safety <- read_csv("Desktop/Stats2018/airline-safety.csv")
View(airline_safety)
```

## Step 1: subtract an airlineâ€™s crash rate from the average for all airlines since 1985
```{r}
# 1985-2014 Average Crash Rate
# Incidents
sumIncidents = 
  (sum(airline_safety$incidents_85_99) 
   + sum(airline_safety$incidents_00_14)) / (nrow(airline_safety) * 2)

# Fatal Incidents
sumFatalAccident = 
  (sum(airline_safety$fatal_accidents_85_99) 
   + sum(airline_safety$fatal_accidents_00_14)) / (nrow(airline_safety) * 2)

# Total Fatalities
sumTotalFatalities = 
  (sum(airline_safety$fatalities_85_99) 
   + sum(airline_safety$fatalities_00_14)) / (nrow(airline_safety) * 2)

# 85 to 99
airline_safety$Score_indident_Rate_85_99 = 
  sumIncidents - airline_safety$incidents_85_99 

airline_safety$Score_fatalAccident_Rate_85_99 = 
  sumFatalAccident - airline_safety$fatal_accidents_85_99

airline_safety$Score_fatalities_Rate_85_99 = 
  sumTotalFatalities - airline_safety$fatalities_85_99

# 00 to 14
airline_safety$Score_indident_Rate_00_14 = 
  sumIncidents - airline_safety$incidents_00_14

airline_safety$Score_fatalAccident_Rate_00_14 = 
  sumFatalAccident - airline_safety$fatal_accidents_00_14

airline_safety$Score_fatalities_Rate_00_14 = 
  sumTotalFatalities - airline_safety$fatalities_00_14
```

## Step 2: Multiply the result by the square root of the number of seat kilometers flown
```{r}
# square root of ASK
airline_safety$ASKsqrt = sqrt((airline_safety$avail_seat_km_per_week * 52 * 15))

# 85 to 99
airline_safety$Score_indident_Rate_85_99 = 
  airline_safety$Score_indident_Rate_85_99 * airline_safety$ASKsqrt

airline_safety$Score_fatalAccident_Rate_85_99 = 
  airline_safety$Score_fatalAccident_Rate_85_99 * airline_safety$ASKsqrt

airline_safety$Score_fatalities_Rate_85_99 = 
  airline_safety$Score_fatalities_Rate_85_99 * airline_safety$ASKsqrt

# 00 to 14
airline_safety$Score_indident_Rate_00_14 = 
  airline_safety$Score_indident_Rate_00_14 * airline_safety$ASKsqrt

airline_safety$Score_fatalAccident_Rate_00_14 = 
  airline_safety$Score_fatalAccident_Rate_00_14 * airline_safety$ASKsqrt

airline_safety$Score_fatalities_Rate_00_14 = 
  airline_safety$Score_fatalities_Rate_00_14 * airline_safety$ASKsqrt
```

## Step 3: Standardize the score in each category to calculate how many standard deviations an airline is above or below the mean
```{r}
# I used the scale() function in r to calculate z-score/standardize

# 85 to 99
airline_safety$Score_indident_Rate_85_99 = 
  scale(airline_safety$Score_indident_Rate_85_99)

airline_safety$Score_fatalAccident_Rate_85_99 = 
  scale(airline_safety$Score_fatalAccident_Rate_85_99)

airline_safety$Score_fatalities_Rate_85_99 = 
  scale(airline_safety$Score_fatalities_Rate_85_99)

# 00 to 14
airline_safety$Score_indident_Rate_00_14 = 
  scale(airline_safety$Score_indident_Rate_00_14)

airline_safety$Score_fatalAccident_Rate_00_14 = 
  scale(airline_safety$Score_fatalAccident_Rate_00_14)

airline_safety$Score_fatalities_Rate_00_14 = 
  scale(airline_safety$Score_fatalities_Rate_00_14)
```

## Step 3 Continued: average the scores from the three categories together to get the Safety Score
```{r}
airline_safety$SafetyScore_85_99 = (airline_safety$Score_indident_Rate_85_99 
                                    + airline_safety$Score_fatalAccident_Rate_85_99 
                                    + airline_safety$Score_fatalities_Rate_85_99) / 3
airline_safety$SafetyScore_00_14 = (airline_safety$Score_indident_Rate_00_14
                                   + airline_safety$Score_fatalAccident_Rate_00_14
                                   + airline_safety$Score_fatalities_Rate_00_14) / 3
```

## Combined Safety Score
```{r}
airline_safety$Combined_Safety_Score = 
  (airline_safety$SafetyScore_85_99 + airline_safety$SafetyScore_00_14) / 2
```

## Plots

### 1985-99 vs 2000-14 Safety Scores
```{r}
plot(airline_safety$SafetyScore_85_99, airline_safety$SafetyScore_00_14, 
     xlab="1985-99 Safety Scores", ylab="2000-14 Safety Scores", 
     main = "1985-99 vs 2000-14 Safety Scores")
```

### Zoom in on top right corner of plot
```{r}
plot(airline_safety$SafetyScore_85_99, airline_safety$SafetyScore_00_14, 
     xlab="1985-99 Safety Scores", ylab="2000-14 Safety Scores", 
     main = "1985-99 vs 2000-14 Safety Scores Zoom", 
     xlim=c(-0.6, 1), ylim=c(-1, 1))
```


## Dataframe for just Safety Scores
```{r}
Safety_Scores_DF = data.frame(airline_safety$airline, 
                     airline_safety$SafetyScore_85_99, 
                     airline_safety$SafetyScore_00_14, 
                     airline_safety$Combined_Safety_Score)
Safety_Scores_DF = 
  Safety_Scores_DF[order(Safety_Scores_DF$airline_safety.Combined_Safety_Score,
                         decreasing = TRUE),]

head(Safety_Scores_DF)
```
